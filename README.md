# Агент-Трейдер
Мультиагентная система для автоматизированной торговли

## Оглавление
- [Описание проекта](#описание-проекта)
- [Архитектура](#архитектура)
- [Компоненты](#компоненты)
- [Установка и запуск](#установка-и-запуск)
- [Использование](#использование)
- [Примеры запросов](#примеры-запросов)
- [Примечания](#примечания)

## Описание проекта
TradeMind — демонстрационный стек для автоматической торговли, реализованный через мультиагентную систему:
- Сбор и анализ новостей
- Генерация технических сигналов
- Объединение сигналов и принятие торговых решений
- Исполнение сделок и ведение портфеля

## Архитектура
Система состоит из следующих элементов:
1. **Postgres** — хранит сделки и результаты анализа новостей.  
2. **MCP Alchemy (FastAPI)** — преобразует HTTP-запросы `/v1/query` и `/v1/execute` в SQL, передавая их в Postgres.  
3. **agent (LangGraph)** — основной вычислительный граф, выполняет агрегацию цен, технический анализ и общение с LLM.  
4. **RSS-листенер** — собирает RSS-ленты, очищает текст статей и сохраняет структурированные сигналы.

## Компоненты
- **Wallet**  
  Управляет портфелем, проверяет лимиты, рассчитывает комиссии и P&L, формирует транзакции.

- **Новостной агент**  
  - Подписка на RSS-ленты крипто-СМИ  
  - Очистка текста статей  
  - Определение актива, тональности и уверенности через LLM  
  - Сохранение сигналов в таблицу `news_llm_cache`

- **Агент трейдер**  
  - Запрос исторических данных через ccxt  
  - Расчёт SMA, EMA, MACD, RSI, полос Боллинджера на 5-минутных свечах  
  - Формирование оценки «силы» сигнала от –1 до +1

- **Торговый агент**  
  - Интеграция новостных и технических сигналов  
  - Формирование промпта для LLM: системная инструкция + цены + техсигналы + новости  
  - Обработка JSON-ответа OpenRouter с командами `BUY`/`SELL`/`HOLD`  
  - Резервный детерминированный алгоритм при проблемах с LLM  
  - Передача команд Wallet через MCP

- **Streamlit-дашборд**  
  В реальном времени показывает баланс, equity-кривую, историю сделок и события графа.

## Установка и запуск
```bash
git clone --recursive https://github.com/nikks-k/TradeMind.git
cd TradeMind                    # переходим в проект
docker compose up --build -d    # сборка и старт 4 сервисов
```

## Использование

Проект реализован в виде веб-интерфейса с имитированным инвестиционным портфелем пользователя
- **Баланс кошелька** — текущее состояние доступных средств  
- **Состав портфеля** — список приобретённых активов и их актуальная стоимость  
- **Прибыль/Убыток** — общий P&L и по каждой позиции  
- **Последние мысли агента** — логи решений, обоснования сигналов и рекомендаций  

## Примеры запросов
```bash
# последние новости
curl -s -X POST http://localhost:8081/v1/query \
 -H 'Content-Type: application/json' \
 -d '{"query":"SELECT asset,sentiment,confidence FROM news_llm_cache ORDER BY created_at DESC LIMIT 3;"}' | jq

# P&L по сделкам
curl -s -X POST http://localhost:8081/v1/query \
 -H 'Content-Type: application/json' \
 -d '{"query":"SELECT side, SUM(realized_pnl) FROM trades GROUP BY side;"}' | jq
```

## Примечания
Проект использует MCP Alchemy: https://github.com/runekaagaard/mcp-alchemy